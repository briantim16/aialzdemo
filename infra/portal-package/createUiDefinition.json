{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "config": {
      "basics": {
        "description": "Deploy a secure AI/ML Landing Zone with network isolation, private endpoints, and Azure AI Foundry. Choose from pre-configured profiles or customize your deployment.",
        "location": {
          "label": "Region",
          "toolTip": "Azure region for AI Landing Zone resources. Only regions with Azure OpenAI availability are listed.",
          "resourceTypes": [
            "Microsoft.Resources/resourceGroups"
          ],
          "allowedValues": [
            "australiaeast",
            "brazilsouth",
            "canadacentral",
            "canadaeast",
            "centralindia",
            "eastasia",
            "eastus",
            "eastus2",
            "francecentral",
            "germanywestcentral",
            "japaneast",
            "koreacentral",
            "northeurope",
            "norwayeast",
            "southafricanorth",
            "southcentralus",
            "southeastasia",
            "uksouth"
          ]
        }
      }
    },
    "basics": [
      {
        "name": "baseName",
        "type": "Microsoft.Common.TextBox",
        "label": "Base Name",
        "defaultValue": "aimldefault",
        "toolTip": "Base name to seed resource names (minimum 6 characters required).",
        "constraints": {
          "required": true,
          "regex": "^[a-z0-9]{6,12}$",
          "validationMessage": "Base name must be 6-12 characters, lowercase letters and numbers only."
        },
        "visible": true
      },
      {
        "name": "resourceToken",
        "type": "Microsoft.Common.TextBox",
        "label": "Resource Token",
        "defaultValue": "autogentoken",
        "toolTip": "Deterministic token for resource names (minimum 6 characters required).",
        "constraints": {
          "required": true,
          "regex": "^[a-z0-9]{6,13}$",
          "validationMessage": "Resource token must be 6-13 characters, lowercase letters and numbers only."
        },
        "visible": true
      },
      {
        "name": "enableTelemetry",
        "type": "Microsoft.Common.OptionsGroup",
        "label": "Enable Telemetry",
        "defaultValue": "Yes",
        "toolTip": "Enable usage telemetry for the module (anonymous data collection for Azure Verified Modules)",
        "constraints": {
          "required": false,
          "allowedValues": [
            {
              "label": "Yes",
              "value": true
            },
            {
              "label": "No",
              "value": false
            }
          ]
        }
      }
    ],
    "steps": [
      {
        "name": "installProfile",
        "label": "Installation Profile",
        "elements": [
          {
            "name": "profileInfo",
            "type": "Microsoft.Common.InfoBox",
            "visible": true,
            "options": {
              "icon": "Info",
              "text": "Choose an installation profile to quickly configure your AI/ML Landing Zone. You can customize individual components after selecting a profile.",
              "uri": "https://github.com/Azure/bicep-avm-ptn-aiml-landing-zone"
            }
          },
          {
            "name": "installationProfile",
            "type": "Microsoft.Common.DropDown",
            "label": "Installation Profile",
            "defaultValue": "Full - Complete AI/ML Platform",
            "toolTip": "Select the installation profile. Full includes all services, Core includes essential AI services, Custom lets you choose each component.",
            "constraints": {
              "required": true,
              "allowedValues": [
                {
                  "label": "Full - Complete AI/ML Platform",
                  "value": "full"
                },
                {
                  "label": "Core - Essential AI Services",
                  "value": "core"
                },
                {
                  "label": "Custom - Select Individual Components",
                  "value": "custom"
                }
              ]
            },
            "visible": true
          },
          {
            "name": "profileSummary",
            "type": "Microsoft.Common.Section",
            "label": "Selected Profile Summary",
            "visible": "[not(equals(steps('installProfile').installationProfile, 'custom'))]",
            "elements": [
              {
                "name": "fullProfileComponents",
                "type": "Microsoft.Common.TextBlock",
                "visible": "[equals(steps('installProfile').installationProfile, 'full')]",
                "options": {
                  "text": "The Full profile deploys:\n\n✓ Networking: Virtual Network, 7 Network Security Groups, VNet Peering, Application Gateway, Azure Firewall\n✓ AI/ML Core: AI Search, Cosmos DB, Storage Account, Key Vault, App Configuration\n✓ Observability: Log Analytics, Application Insights\n✓ Container Platform: Container Registry, Container Apps Environment, Container Apps\n✓ API & Management: API Management\n✓ Security & Access: Bastion Host, Jump VM, Build VM\n✓ Additional: Bing Grounding, WAF Policy\n\nTotal: 28 components + supporting resources"
                }
              },
              {
                "name": "coreProfileComponents",
                "type": "Microsoft.Common.TextBlock",
                "visible": "[equals(steps('installProfile').installationProfile, 'core')]",
                "options": {
                  "text": "The Core profile deploys essential AI services:\n\n✓ Networking: Virtual Network, Agent NSG, Private Endpoints NSG\n✓ AI/ML Core: AI Search, Cosmos DB, Storage Account, Key Vault, App Configuration\n✓ Observability: Log Analytics, Application Insights\n✓ Container Platform: Container Registry\n\n✗ Optional Services Excluded: API Management, Application Gateway, Azure Firewall, Container Apps, Build/Jump VMs, Bastion, Bing Grounding\n\nTotal: 11 core components"
                }
              }
            ]
          }
        ]
      },
      {
        "name": "componentSelection",
        "label": "Component Selection",
        "elements": [
          {
            "name": "customModeInfo",
            "type": "Microsoft.Common.InfoBox",
            "visible": true,
            "options": {
              "icon": "Info",
              "text": "This step is only used when 'Custom' installation profile is selected. If you selected 'Full' or 'Core' profile, you can skip this step - components will be deployed according to your profile selection.",
              "uri": "https://github.com/Azure/bicep-avm-ptn-aiml-landing-zone/blob/main/docs/parameters.md"
            }
          },
          {
            "name": "networkingSection",
            "type": "Microsoft.Common.Section",
            "label": "Networking Components",
            "elements": [
              {
                "name": "virtualNetwork",
                "type": "Microsoft.Common.CheckBox",
                "label": "Virtual Network",
                "toolTip": "Deploy a new Virtual Network with subnets for AI/ML workloads, private endpoints, and optional Application Gateway/API Management/Container Apps subnets"
              },
              {
                "name": "agentNsg",
                "type": "Microsoft.Common.CheckBox",
                "label": "Agent Subnet NSG",
                "toolTip": "Deploy Network Security Group for the agent (workload) subnet"
              },
              {
                "name": "peNsg",
                "type": "Microsoft.Common.CheckBox",
                "label": "Private Endpoints Subnet NSG",
                "toolTip": "Deploy Network Security Group for the private endpoints subnet"
              },
              {
                "name": "applicationGateway",
                "type": "Microsoft.Common.CheckBox",
                "label": "Application Gateway",
                "toolTip": "Deploy Azure Application Gateway for web application routing and load balancing"
              },
              {
                "name": "applicationGatewayNsg",
                "type": "Microsoft.Common.CheckBox",
                "label": "Application Gateway NSG",
                "toolTip": "Deploy Network Security Group for Application Gateway subnet"
              },
              {
                "name": "applicationGatewayPublicIp",
                "type": "Microsoft.Common.CheckBox",
                "label": "Application Gateway Public IP",
                "toolTip": "Deploy a Public IP address for the Application Gateway"
              },
              {
                "name": "firewall",
                "type": "Microsoft.Common.CheckBox",
                "label": "Azure Firewall",
                "toolTip": "Deploy Azure Firewall for network-level security and traffic inspection"
              },
              {
                "name": "wafPolicy",
                "type": "Microsoft.Common.CheckBox",
                "label": "WAF Policy",
                "toolTip": "Deploy Web Application Firewall policy for Application Gateway"
              }
            ]
          },
          {
            "name": "aimlCoreSection",
            "type": "Microsoft.Common.Section",
            "label": "AI/ML Core Services",
            "elements": [
              {
                "name": "searchService",
                "type": "Microsoft.Common.CheckBox",
                "label": "Azure AI Search",
                "toolTip": "Deploy Azure AI Search service for vector search and retrieval-augmented generation (RAG)"
              },
              {
                "name": "cosmosDb",
                "type": "Microsoft.Common.CheckBox",
                "label": "Cosmos DB",
                "toolTip": "Deploy Azure Cosmos DB for NoSQL database capabilities"
              },
              {
                "name": "storageAccount",
                "type": "Microsoft.Common.CheckBox",
                "label": "Storage Account",
                "toolTip": "Deploy Azure Storage Account for blob storage, data lake, and file shares"
              },
              {
                "name": "keyVault",
                "type": "Microsoft.Common.CheckBox",
                "label": "Key Vault",
                "toolTip": "Deploy Azure Key Vault for secrets, keys, and certificates management"
              },
              {
                "name": "appConfig",
                "type": "Microsoft.Common.CheckBox",
                "label": "App Configuration",
                "toolTip": "Deploy Azure App Configuration for centralized application settings management"
              },
              {
                "name": "groundingWithBingSearch",
                "type": "Microsoft.Common.CheckBox",
                "label": "Bing Grounding",
                "toolTip": "Deploy Bing Search resource for grounding AI models with current web data"
              }
            ]
          },
          {
            "name": "observabilitySection",
            "type": "Microsoft.Common.Section",
            "label": "Observability & Monitoring",
            "elements": [
              {
                "name": "logAnalytics",
                "type": "Microsoft.Common.CheckBox",
                "label": "Log Analytics Workspace",
                "toolTip": "Deploy Log Analytics Workspace for centralized logging and monitoring"
              },
              {
                "name": "appInsights",
                "type": "Microsoft.Common.CheckBox",
                "label": "Application Insights",
                "toolTip": "Deploy Application Insights for application performance monitoring (APM)"
              }
            ]
          },
          {
            "name": "containerPlatformSection",
            "type": "Microsoft.Common.Section",
            "label": "Container Platform",
            "elements": [
              {
                "name": "containerRegistry",
                "type": "Microsoft.Common.CheckBox",
                "label": "Container Registry",
                "toolTip": "Deploy Azure Container Registry for storing and managing container images"
              },
              {
                "name": "containerEnv",
                "type": "Microsoft.Common.CheckBox",
                "label": "Container Apps Environment",
                "toolTip": "Deploy Azure Container Apps Environment for hosting microservices and containerized applications"
              },
              {
                "name": "acaEnvironmentNsg",
                "type": "Microsoft.Common.CheckBox",
                "label": "Container Apps Environment NSG",
                "toolTip": "Deploy Network Security Group for Azure Container Apps Environment subnet"
              },
              {
                "name": "containerApps",
                "type": "Microsoft.Common.CheckBox",
                "label": "Container Apps",
                "toolTip": "Deploy sample Azure Container Apps for GenAI applications"
              }
            ]
          },
          {
            "name": "apiManagementSection",
            "type": "Microsoft.Common.Section",
            "label": "API Management",
            "elements": [
              {
                "name": "apiManagement",
                "type": "Microsoft.Common.CheckBox",
                "label": "API Management",
                "toolTip": "Deploy Azure API Management for API gateway, security, and management capabilities"
              },
              {
                "name": "apiManagementNsg",
                "type": "Microsoft.Common.CheckBox",
                "label": "API Management NSG",
                "toolTip": "Deploy Network Security Group for API Management subnet"
              }
            ]
          },
          {
            "name": "securityAccessSection",
            "type": "Microsoft.Common.Section",
            "label": "Security & Access",
            "elements": [
              {
                "name": "bastionHost",
                "type": "Microsoft.Common.CheckBox",
                "label": "Azure Bastion",
                "toolTip": "Deploy Azure Bastion for secure RDP/SSH access to virtual machines"
              },
              {
                "name": "jumpVm",
                "type": "Microsoft.Common.CheckBox",
                "label": "Jump VM",
                "toolTip": "Deploy a Jump Box virtual machine for secure access to the landing zone"
              },
              {
                "name": "jumpboxNsg",
                "type": "Microsoft.Common.CheckBox",
                "label": "Jumpbox NSG",
                "toolTip": "Deploy Network Security Group for Jumpbox subnet"
              },
              {
                "name": "buildVm",
                "type": "Microsoft.Common.CheckBox",
                "label": "Build VM",
                "toolTip": "Deploy a Build virtual machine for DevOps build agents"
              },
              {
                "name": "devopsBuildAgentsNsg",
                "type": "Microsoft.Common.CheckBox",
                "label": "DevOps Build Agents NSG",
                "toolTip": "Deploy Network Security Group for DevOps build agents subnet"
              }
            ]
          }
        ]
      },
      {
        "name": "networkConfig",
        "label": "Network Configuration",
        "elements": [
          {
            "name": "networkConfigInfo",
            "type": "Microsoft.Common.InfoBox",
            "visible": true,
            "options": {
              "icon": "Info",
              "text": "Configure network settings for your AI/ML Landing Zone. You can create a new virtual network or integrate with an existing platform landing zone.",
              "uri": "https://github.com/Azure/bicep-avm-ptn-aiml-landing-zone/blob/main/docs/how_to_use.md"
            }
          },
          {
            "name": "platformLandingZone",
            "type": "Microsoft.Common.CheckBox",
            "label": "Platform Landing Zone Integration",
            "toolTip": "Enable platform landing zone integration. When true, private DNS zones and private endpoints are managed by the platform landing zone."
          },
          {
            "name": "platformLzInfo",
            "type": "Microsoft.Common.InfoBox",
            "visible": "[steps('networkConfig').platformLandingZone]",
            "options": {
              "icon": "Info",
              "text": "Platform Landing Zone mode: Private DNS zones will not be created. Instead, the deployment expects existing platform-managed DNS zones. Private endpoints will be configured to use those zones.",
              "uri": "https://learn.microsoft.com/azure/cloud-adoption-framework/ready/landing-zone/"
            }
          },
          {
            "name": "vnetDeploymentMode",
            "type": "Microsoft.Common.OptionsGroup",
            "label": "Virtual Network Deployment",
            "defaultValue": "Create new VNet",
            "toolTip": "Choose whether to create a new virtual network or use an existing one",
            "constraints": {
              "required": true,
              "allowedValues": [
                {
                  "label": "Create new VNet",
                  "value": "new"
                },
                {
                  "label": "Use existing VNet",
                  "value": "existing"
                }
              ]
            },
            "visible": "[or(equals(steps('installProfile').installationProfile, 'full'), equals(steps('installProfile').installationProfile, 'core'), steps('componentSelection').networkingSection.virtualNetwork)]"
          },
          {
            "name": "existingVnetInfo",
            "type": "Microsoft.Common.InfoBox",
            "visible": "[equals(steps('networkConfig').vnetDeploymentMode, 'existing')]",
            "options": {
              "icon": "Warning",
              "text": "When using an existing VNet, you'll need to provide the resource ID in the Advanced Configuration step. The deployment will add required subnets to the existing VNet.",
              "uri": "https://github.com/Azure/bicep-avm-ptn-aiml-landing-zone/blob/main/docs/parameters.md"
            }
          }
        ]
      },
      {
        "name": "advancedConfig",
        "label": "Advanced Configuration",
        "elements": [
          {
            "name": "advancedInfo",
            "type": "Microsoft.Common.InfoBox",
            "visible": true,
            "options": {
              "icon": "Info",
              "text": "Advanced settings for reusing existing resources and configuring resource-specific options. Leave fields empty to create all resources from scratch.",
              "uri": "https://github.com/Azure/bicep-avm-ptn-aiml-landing-zone/blob/main/docs/parameters.md"
            }
          },
          {
            "name": "tagsSection",
            "type": "Microsoft.Common.Section",
            "label": "Resource Tags",
            "elements": [
              {
                "name": "tagsInfo",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Tags can be added after deployment via the Azure Portal or CLI. The template will deploy without custom tags by default."
                }
              }
            ]
          },
          {
            "name": "existingResourcesSection",
            "type": "Microsoft.Common.Section",
            "label": "Existing Resource IDs (Optional)",
            "elements": [
              {
                "name": "existingResourcesInfo",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Provide resource IDs for existing resources you want to reuse instead of creating new ones. Leave empty to create all resources."
                }
              },
              {
                "name": "virtualNetworkResourceId",
                "type": "Microsoft.Common.TextBox",
                "label": "Virtual Network Resource ID",
                "defaultValue": "",
                "toolTip": "Existing VNet resource ID to reuse. Format: /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Network/virtualNetworks/{vnetName}",
                "constraints": {
                  "required": false,
                  "regex": "^$|^/subscriptions/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/resourceGroups/[^/]+/providers/Microsoft.Network/virtualNetworks/[^/]+$",
                  "validationMessage": "Must be a valid Azure Virtual Network resource ID or empty"
                },
                "visible": "[equals(steps('networkConfig').vnetDeploymentMode, 'existing')]"
              },
              {
                "name": "logAnalyticsWorkspaceResourceId",
                "type": "Microsoft.Common.TextBox",
                "label": "Log Analytics Workspace Resource ID",
                "defaultValue": "",
                "toolTip": "Existing Log Analytics Workspace resource ID to reuse",
                "constraints": {
                  "required": false,
                  "regex": "^$|^/subscriptions/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/resourceGroups/[^/]+/providers/Microsoft.OperationalInsights/workspaces/[^/]+$",
                  "validationMessage": "Must be a valid Log Analytics Workspace resource ID or empty"
                }
              },
              {
                "name": "appInsightsResourceId",
                "type": "Microsoft.Common.TextBox",
                "label": "Application Insights Resource ID",
                "defaultValue": "",
                "toolTip": "Existing Application Insights resource ID to reuse",
                "constraints": {
                  "required": false,
                  "regex": "^$|^/subscriptions/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/resourceGroups/[^/]+/providers/Microsoft.Insights/components/[^/]+$",
                  "validationMessage": "Must be a valid Application Insights resource ID or empty"
                }
              },
              {
                "name": "storageAccountResourceId",
                "type": "Microsoft.Common.TextBox",
                "label": "Storage Account Resource ID",
                "defaultValue": "",
                "toolTip": "Existing Storage Account resource ID to reuse",
                "constraints": {
                  "required": false,
                  "regex": "^$|^/subscriptions/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/resourceGroups/[^/]+/providers/Microsoft.Storage/storageAccounts/[^/]+$",
                  "validationMessage": "Must be a valid Storage Account resource ID or empty"
                }
              },
              {
                "name": "keyVaultResourceId",
                "type": "Microsoft.Common.TextBox",
                "label": "Key Vault Resource ID",
                "defaultValue": "",
                "toolTip": "Existing Key Vault resource ID to reuse",
                "constraints": {
                  "required": false,
                  "regex": "^$|^/subscriptions/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/resourceGroups/[^/]+/providers/Microsoft.KeyVault/vaults/[^/]+$",
                  "validationMessage": "Must be a valid Key Vault resource ID or empty"
                }
              },
              {
                "name": "containerRegistryResourceId",
                "type": "Microsoft.Common.TextBox",
                "label": "Container Registry Resource ID",
                "defaultValue": "",
                "toolTip": "Existing Azure Container Registry resource ID to reuse",
                "constraints": {
                  "required": false,
                  "regex": "^$|^/subscriptions/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/resourceGroups/[^/]+/providers/Microsoft.ContainerRegistry/registries/[^/]+$",
                  "validationMessage": "Must be a valid Container Registry resource ID or empty"
                }
              }
            ]
          }
        ]
      },
      {
        "name": "reviewSummary",
        "label": "Review + Create",
        "elements": [
          {
            "name": "reviewInfo",
            "type": "Microsoft.Common.InfoBox",
            "visible": true,
            "options": {
              "icon": "Info",
              "text": "Review your configuration before deployment. The AI/ML Landing Zone will be deployed with the selected components and settings.",
              "uri": "https://github.com/Azure/bicep-avm-ptn-aiml-landing-zone"
            }
          },
          {
            "name": "deploymentSummary",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "[concat('Installation Profile: ', steps('installProfile').installationProfile, '\nRegion: ', location(), '\nPlatform Landing Zone: ', if(steps('networkConfig').platformLandingZone, 'Enabled', 'Disabled'))]"
            }
          }
        ]
      }
    ],
    "outputs": {
      "location": "[location()]",
      "baseName": "[basics('baseName')]",
      "resourceToken": "[basics('resourceToken')]",
      "enableTelemetry": "[basics('enableTelemetry')]",
      "flagPlatformLandingZone": "[steps('networkConfig').platformLandingZone]",
      "tags": {},
      "deployToggles": {
        "logAnalytics": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').observabilitySection.logAnalytics, if(equals(steps('installProfile').installationProfile, 'core'), true, true))]",
        "appInsights": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').observabilitySection.appInsights, if(equals(steps('installProfile').installationProfile, 'core'), true, true))]",
        "containerEnv": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').containerPlatformSection.containerEnv, if(equals(steps('installProfile').installationProfile, 'core'), false, true))]",
        "containerRegistry": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').containerPlatformSection.containerRegistry, if(equals(steps('installProfile').installationProfile, 'core'), true, true))]",
        "cosmosDb": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').aimlCoreSection.cosmosDb, if(equals(steps('installProfile').installationProfile, 'core'), true, true))]",
        "keyVault": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').aimlCoreSection.keyVault, if(equals(steps('installProfile').installationProfile, 'core'), true, true))]",
        "storageAccount": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').aimlCoreSection.storageAccount, if(equals(steps('installProfile').installationProfile, 'core'), true, true))]",
        "searchService": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').aimlCoreSection.searchService, if(equals(steps('installProfile').installationProfile, 'core'), true, true))]",
        "groundingWithBingSearch": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').aimlCoreSection.groundingWithBingSearch, if(equals(steps('installProfile').installationProfile, 'core'), false, true))]",
        "appConfig": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').aimlCoreSection.appConfig, if(equals(steps('installProfile').installationProfile, 'core'), true, true))]",
        "apiManagement": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').apiManagementSection.apiManagement, if(equals(steps('installProfile').installationProfile, 'core'), false, true))]",
        "applicationGateway": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').networkingSection.applicationGateway, if(equals(steps('installProfile').installationProfile, 'core'), false, true))]",
        "applicationGatewayPublicIp": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').networkingSection.applicationGatewayPublicIp, if(equals(steps('installProfile').installationProfile, 'core'), false, true))]",
        "firewall": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').networkingSection.firewall, if(equals(steps('installProfile').installationProfile, 'core'), false, true))]",
        "containerApps": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').containerPlatformSection.containerApps, if(equals(steps('installProfile').installationProfile, 'core'), false, true))]",
        "buildVm": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').securityAccessSection.buildVm, if(equals(steps('installProfile').installationProfile, 'core'), false, true))]",
        "bastionHost": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').securityAccessSection.bastionHost, if(equals(steps('installProfile').installationProfile, 'core'), false, true))]",
        "jumpVm": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').securityAccessSection.jumpVm, if(equals(steps('installProfile').installationProfile, 'core'), false, true))]",
        "virtualNetwork": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').networkingSection.virtualNetwork, if(equals(steps('installProfile').installationProfile, 'core'), true, true))]",
        "wafPolicy": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').networkingSection.wafPolicy, if(equals(steps('installProfile').installationProfile, 'core'), false, true))]",
        "agentNsg": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').networkingSection.agentNsg, if(equals(steps('installProfile').installationProfile, 'core'), true, true))]",
        "peNsg": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').networkingSection.peNsg, if(equals(steps('installProfile').installationProfile, 'core'), true, true))]",
        "applicationGatewayNsg": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').networkingSection.applicationGatewayNsg, if(equals(steps('installProfile').installationProfile, 'core'), false, true))]",
        "apiManagementNsg": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').apiManagementSection.apiManagementNsg, if(equals(steps('installProfile').installationProfile, 'core'), false, true))]",
        "acaEnvironmentNsg": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').containerPlatformSection.acaEnvironmentNsg, if(equals(steps('installProfile').installationProfile, 'core'), false, true))]",
        "jumpboxNsg": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').securityAccessSection.jumpboxNsg, if(equals(steps('installProfile').installationProfile, 'core'), false, true))]",
        "devopsBuildAgentsNsg": "[if(equals(steps('installProfile').installationProfile, 'custom'), steps('componentSelection').securityAccessSection.devopsBuildAgentsNsg, if(equals(steps('installProfile').installationProfile, 'core'), false, true))]"
      },
      "resourceIds": {
        "virtualNetworkResourceId": "[steps('advancedConfig').existingResourcesSection.virtualNetworkResourceId]",
        "logAnalyticsWorkspaceResourceId": "[steps('advancedConfig').existingResourcesSection.logAnalyticsWorkspaceResourceId]",
        "appInsightsResourceId": "[steps('advancedConfig').existingResourcesSection.appInsightsResourceId]",
        "storageAccountResourceId": "[steps('advancedConfig').existingResourcesSection.storageAccountResourceId]",
        "keyVaultResourceId": "[steps('advancedConfig').existingResourcesSection.keyVaultResourceId]",
        "containerRegistryResourceId": "[steps('advancedConfig').existingResourcesSection.containerRegistryResourceId]"
      },
      "privateDnsZonesDefinition": null,
      "nsgDefinitions": null,
      "vNetDefinition": {
        "addressPrefixes": [
          "192.168.0.0/22"
        ],
        "name": "[concat('vnet-', coalesce(basics('baseName'), basics('resourceToken'), 'aiml'))]"
      },
      "existingVNetSubnetsDefinition": null,
      "apimPrivateDnsZoneDefinition": null,
      "cognitiveServicesPrivateDnsZoneDefinition": null,
      "openAiPrivateDnsZoneDefinition": null,
      "aiServicesPrivateDnsZoneDefinition": null,
      "searchPrivateDnsZoneDefinition": null,
      "cosmosPrivateDnsZoneDefinition": null,
      "blobPrivateDnsZoneDefinition": null,
      "keyVaultPrivateDnsZoneDefinition": null,
      "appConfigPrivateDnsZoneDefinition": null,
      "containerAppsPrivateDnsZoneDefinition": null,
      "acrPrivateDnsZoneDefinition": null,
      "appInsightsPrivateDnsZoneDefinition": null,
      "appGatewayPublicIp": null,
      "firewallPublicIp": null,
      "hubVnetPeeringDefinition": null,
      "appConfigPrivateEndpointDefinition": null,
      "apimPrivateEndpointDefinition": null,
      "containerAppEnvPrivateEndpointDefinition": null,
      "acrPrivateEndpointDefinition": null,
      "storageBlobPrivateEndpointDefinition": null,
      "cosmosPrivateEndpointDefinition": null,
      "searchPrivateEndpointDefinition": null,
      "keyVaultPrivateEndpointDefinition": null,
      "logAnalyticsDefinition": null,
      "appInsightsDefinition": null,
      "containerAppEnvDefinition": null,
      "containerRegistryDefinition": null,
      "containerAppsList": null,
      "storageAccountDefinition": null,
      "appConfigurationDefinition": null,
      "cosmosDbDefinition": null,
      "keyVaultDefinition": null,
      "aiSearchDefinition": null,
      "apimDefinition": null,
      "aiFoundryDefinition": {
        "baseName": "[basics('baseName')]",
        "aiModelDeployments": [
          {
            "model": {
              "format": "OpenAI",
              "name": "gpt-35-turbo",
              "version": "0125"
            },
            "name": "gpt-35-turbo",
            "sku": {
              "name": "Standard",
              "capacity": 10
            }
          },
          {
            "model": {
              "format": "OpenAI",
              "name": "text-embedding-ada-002",
              "version": "2"
            },
            "name": "text-embedding-ada-002",
            "sku": {
              "name": "Standard",
              "capacity": 1
            }
          }
        ]
      },
      "groundingWithBingDefinition": null,
      "wafPolicyDefinition": null,
      "appGatewayDefinition": null,
      "firewallPolicyDefinition": null,
      "firewallDefinition": null,
      "buildVmDefinition": null,
      "buildVmMaintenanceDefinition": null,
      "jumpVmDefinition": null,
      "jumpVmMaintenanceDefinition": null
    }
  }
}
